<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Beubi CS!</title>

        <link rel="stylesheet" href="http://beubi.bitbucket.org/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://beubi.bitbucket.org/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://beubi.bitbucket.org/css/highlight.dark.css">
        <link rel="stylesheet" href="http://beubi.bitbucket.org/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="http://beubi.bitbucket.org/">
                Beubi CS!
                <small class="hidden-xs hidden-sm">
                    This is a great project.
                </small>
            </a>

            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                        <ul class="nav nav-pills nav-stacked">
                                                            <li class="">
                                    <a href="http://beubi.bitbucket.org/index.html">
                                        Home page
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://beubi.bitbucket.org/phpcs.html">
                                        PHP CS
                                    </a>
                                </li>
                                                            <li class="active">
                                    <a href="http://beubi.bitbucket.org/jscs.html">
                                        JS CS
                                    </a>
                                </li>
                                                    </ul>

                    </nav>

                
                <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1>Coding standards for JavaScript</h1>
<blockquote>
<p>THIS DOCUMENT IS A DRAFT / PROPOSAL.</p>
<p>DO NOT CONSIDER IT ANYTHING OFFICIAL FOR NOW.</p>
</blockquote>
<p>This guide describes the set of rules we apply
on the frontend, mostly with JavaScript.</p>
<h2>Formatting</h2>
<p>We follow some very basic rules:</p>
<ul>
<li>brackets always open on the same line (<code>if (...) {</code>)</li>
<li>and <code>else</code> too (<code>} else {</code>)</li>
<li>multiple assignments don't need a newline</li>
<li>between a statement and <strong>anything else</strong> we add a newline</li>
<li>always add a newline before a <code>return</code>, unless it's the only code in the block</li>
<li>function names should be camel-cased (<code>myFunction</code>)</li>
<li>objects intended as blueprints, or constructors, should be in upper-case (<code>var MyObject = function() {}; var myObject = new MyObject()</code>)</li>
<li>members follow the same convention (<code>a.propertyName</code>)</li>
<li>use JsHint as much as possible :)</li>
<li>avoid global, native variables as much as possible (such as <code>window</code>), use proxies instead</li>
<li>use 2 spaces to indent</li>
<li>no need to add a space between the <code>function</code> keyword and its arguments (<code>function(a, b)</code>)</li>
<li>add a space between function arguments and the opening bracket (<code>function() {</code>)</li>
<li>separate arguments with one space after the columns (<code>function(a, b, c)</code>)</li>
<li>wrap self calling functions in <code>()</code> (<code>(function() {}())</code>), and don't abuse them (they can be confusing)</li>
<li>do not add comments inside your code, that's what the jsdoc is for</li>
<li>cleanup your <code>console.log</code>s before committing</li>
</ul>
<p>Example:</p>
<pre><code class="language-javascript">/**
* My Object Definition
*/

var MyObject = function() {
  this.property = 'value';
}

MyObject.prototype.method = function() {
  console.log('Hello, I\'m a method');
}

var myObject = new MyObject();
myObject.method();

/**
 * My JsDoc.
 */
var foo = {
  doSomething: function(hello, hella) {
    if (something === somethingElse) {
      return 1;
    } else if (iFellLucky) {
      explode(hello, hella);
    }

    return 2;
  }
};
</code></pre>
<h2>Structure</h2>
<p>Projects should contain generic files on their root,
like the <code>.gitignore</code> and <code>gulpfile.js</code>.</p>
<p>Dependencies should be installed in a directory on the
root of a project (both <code>node_modules</code> and <code>bower_components</code>).</p>
<p>Our own codebase should live in a <code>src</code> directory, where
we will divide things between <code>scripts</code> and <code>templates</code>: if
a project contains both vanilla js and nodejs we should
create 2 subfolders under <code>scripts</code>, <code>server</code> and <code>client</code>.</p>
<p>The directory structure should be thought as if it was
namespaced: if we have an <em>api</em> service it should be located
at <code>src/scripts/services/api.js</code>.</p>
<p>We prefer plural names over singular ones, differently from
our API coding standards.</p>
<h2>Scripts</h2>
<p>Should have the <code>.js</code> extension and contain a single unit,
we should never mix classes under the same file: an exception
is when we nee mixins / helpers, where we declare a bunch of
utility methods, with different conceptual scopes, in the same
file.</p>
<pre><code class="language-javascript">var helpers = {
  convertDollarsToEuros: function(amount) {
    // ...
  },
  log: function(what, where) {
    // ...
  }
};</code></pre>
<h2>Objects</h2>
<p>Avoid aliasing objects with a <code>self</code> variable, as
then it could lead to scope issues; prefer aliasing them
with the service &quot;name&quot; instead.
myObjectInstance</p>
<pre><code class="language-javascript">/**
 * User service.
 */
funtion User(){
  var User = this;
};</code></pre>
<p>We don't use prototypes that much: create them with
caution, as they might lead to unneeded complexity --
generally, we found out that they're not really needed
and using plain old vanilla objects speeds us up.</p>
<h2>Methods</h2>
<p>When you need to pass a few arguments to a function,
consider refactoring them as <code>options</code>:</p>
<pre><code class="language-javascript">// mmmmm
http.request(method, url, headers, cookies);

// much better!
var options = {
  method: method,
  url: url,
  headers: headers,
  cookies: cookies
};

http.request(options);</code></pre>
<p>This leads to minimal changes in the function's implementation:</p>
<pre><code class="language-javascript">http.request = function(options) {
  // just add some logic that uses a new option
  // and you don't have to change signature, etc...
}</code></pre>
<h2>Templates</h2>
<p>We prefer using jade as a templating engine, as it saves
a lot of time during coding.
Leverage on <code>includes</code> for repeted partials.</p>
<h2>Toolkit</h2>
<p>Use <a href="http://browserify.org/">browserify</a> as much as possible:
node code is usually much more readable, structured and
simpler than usual frontend libraries and browserify lets us
share code between the backend and the frontend.</p>
<p>For dependency management, use <a href="https://www.npmjs.org/">NPM</a>;
if you need libraries that are only written for the client,
install them via <a href="http://bower.io/">Bower</a>.</p>
<p>For building projects and running development environment you
should use <a href="http://gulpjs.com/">Gulp</a>, which offers much less
complexity compared to Grunt, our old build tool.</p>
<h2>Tests</h2>
<h4>NodeJS</h4>
<ul>
<li>We use <a href="http://visionmedia.github.io/mocha/">mocha</a> as a test suite for node</li>
<li>When test are available add a convenient test command in the <code>script</code> section of your <code>package.json</code></li>
<li>Use the <code>-b</code> option so the tests stop running at the 1st failure (it's easier to fix problems when you don't have a huge list of them)</li>
</ul>
<pre><code class="language-javascript">"scripts": {
   "test": "mocha -b"
  },</code></pre>
<h2>Vanilla JS</h2>
<ul>
<li>avoid <code>undefined</code> as much as possible (have a look <a href="http://shapeshed.com/the-void-of-undefined-in-javascript/">here</a> if you wonder how it might hurt you :))</li>
<li>do not rely on truthy and falsy values: use <code>===</code> and <code>!==</code></li>
<li>always define all the needed variables at the beginning of a function setting them to their itended type even if empty (<code>var list = []</code>, <code>var fooObj = {}</code>, <code>var fooString = ''</code>, etc)</li>
<li>always take care of undefined functions parameters setting a default or <code>null</code> value (<code>function (option) { options = options || null;}</code>)</li>
<li>forget about <code>while</code> statments...</li>
<li>Do not let a promisses silently fail, always pass and error object to your rejections with a meaningful message (<code>q.reject(new Error('Bad things happened'))</code>)</li>
</ul>
<h2>NodeJS</h2>
<h5>Golden rule: never block!</h5>
<h5>2nd Golden rule: never block, even if you don't expect to block!</h5>
<ul>
<li>Beware, you don't block only with cycles: heavily CPU bound operation will make the main thread sit there and wait until is completed. Cloning a big object, or parsing a big JSON (<code>JSON.parse()</code>) will block you like crazy!</li>
</ul>
<p><code>require</code> statements should be on top of each file:</p>
<pre><code class="language-javascript">var a = require('b');</code></pre>
<p>If your <code>module.exports</code> is fairly simple,
declare it straight away:</p>
<pre><code class="language-javascript">module.exports = function() {
  console.log("I'm useless!");
}</code></pre>
<p>but if you have a bunch of things, consider
splitting the object declaration and the export:</p>
<pre><code class="language-javascript">var service = {};

var log = function(what){
  console.log(what);
};

service.doSomething = function() {
  log('doing something');

  // ...
};

service.doSomethingElse = function() {
  log('doing something else');

  // ...
};

service.doSomethingFunky = function() {
  log('doing something funky');

  // ...
};

module.exports = service.</code></pre>
<p>This approach, by the way, lets you declare
&quot;protected&quot; methods.</p>
<p>Prefer recursion to <code>for</code> loops and <code>forEach</code>:</p>
<ul>
<li>it will protect you from the dangers of async calls inside the for loops</li>
<li><code>forEach</code> blocks and <strong>we do not block!</strong></li>
</ul>
<p>Do not tinker with the base api's prototypes (ex: <code>Array.prototype.myFunction = function() {}</code>)
Do use callbacks, but avoid nesting more then 3 of them. Keep it short.</p>
<p>When loading files from the filesystem, be sure not to hardcode paths but use the safe <code>__dirname + path.join(...)</code> syntax so that the scripts can be launched from wherever directory</p>
<p>Example: (assuming the following dir structure)</p>
<pre><code>/appDir/
      |/src/
          |/config/
          |app.js
          |config.js</code></pre>
<p>and <code>config.js</code> (required by <code>app.js</code>) taking care of loading files from the <code>/appDir/src/config/</code> directory</p>
<pre><code class="language-javascript">/*config.js*/

/**
not sure what happens if I run app.js form diff paths if I:
*/
var filePath = './config/' + filename + '.yml');
/* or */
var filePath = '../src/config/' + filename + '.yml');

/**
this will nicely take care of paths
*/
var filePath = path.join(__dirname, './config/' + filename + '.yml');</code></pre>
<p>also a little preventive debug output might help out sys admins track eventual problems:</p>
<pre><code class="language-javascript">console.log('Loading config file: ', filePath);</code></pre>
<p>as well as give a hint to your fellow devs if you really need a config file that needs to be created (or user <a href="https://github.com/namshi/node-file-ensure">file-ensure</a>):</p>
<p>Example: (assuming we need a <code>config/dev.yml</code> file)</p>
<pre><code class="language-javascript">try {
  /* your file opening stuff */
} catch(error){
  if (e.path.match(/dev.yml/g).length &gt; 0 ) {
    console.log('!!!NO dev.yml FOUND!!! Please copy dev.example.yml to dev.yml in your config directory!');
  } else {
    console.log('Error loading yaml config: ', e);
    process.exit(1);
  }
}</code></pre>
                </section>

            </div>
        </main>

        <footer>
            <div class="container-fluid">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="http://yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
