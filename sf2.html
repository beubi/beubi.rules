<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Beubi&#039;s Technical Documentation</title>

        <link rel="stylesheet" href="https://beubi.github.io/beubi.rules/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://beubi.github.io/beubi.rules/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://beubi.github.io/beubi.rules/css/highlight.tomorrow-night.css">
        <link rel="stylesheet" href="https://beubi.github.io/beubi.rules/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="https://beubi.github.io/beubi.rules/">
                Beubi&#039;s Technical Documentation
                <small class="hidden-xs hidden-sm">
                     
                </small>
            </a>

            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                                                    <p class="text-muted">
                                
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/index.html">
                                            Introduction
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Workflow
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/git.html">
                                            <i class="fa fa-bitbucket" aria-hidden="true"></i> Git - Version Control System
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/1todo.html">
                                            1. To Do
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/2readywork.html">
                                            2. Ready For Work
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/3development.html">
                                            3. Development
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/4codereview.html">
                                            4. Code Review
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/5functionalreview.html">
                                            5. Functional Review
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/6readydeploy.html">
                                            6. Ready To Deploy
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/7deployed.html">
                                            7. Deployed
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/multipleissues.html">
                                            <i class="fa fa-files-o" aria-hidden="true"></i> Multiple Issues
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/communication.html">
                                            <i class="fa fa-comments-o" aria-hidden="true"></i> Communication
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Coding Standard
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/phpcs.html">
                                            PHP
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/jscs.html">
                                            JavaScript
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://beubi.github.io/beubi.rules/composer.html">
                                            Composer
                                        </a>
                                    </li>
                                                                    <li class="active">
                                        <a href="https://beubi.github.io/beubi.rules/sf2.html">
                                            Symfony2
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                
                <section class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1><strong> Symfony2 Guidelines </strong></h1>
<h2><a name="Routing"></a>Routing</h2>
<p>Routing is being configured through annotation like:</p>
<pre><code>@Route("/something", name="somename")
@Method("GET/POST/DELETE")</code></pre>
<p>Where name should be something meaningful for the business/domain plus controller name</p>
<p>Parameter Conversion
Whenever we have an id that is being pass to a controller as parameter but we want to use the class instead:</p>
<pre><code>@ParamConverter("Classname", class="BeubiBundle:Classname", options={"id" = "thing-id"})</code></pre>
<h2><a name="Templating"></a>Templating</h2>
<p>Templates are place under Resources/views and are injected in controllers as services.
Their paths should be given like this:</p>
<pre><code>@Template("BeubiBundle:Thing:index.html.twig")</code></pre>
<p>This means that no controller should return Response, but an array instead.</p>
<h2><a name="Entities"></a>Entities</h2>
<p>Documentation for gedmo extensions
<a href="https://github.com/Atlantic18/DoctrineExtensions/tree/master/doc">https://github.com/Atlantic18/DoctrineExtensions/tree/master/doc</a>
Documentation for doctrine
<a href="http://docs.doctrine-project.org/projects/doctrine-common/en/latest/reference/annotations.html">http://docs.doctrine-project.org/projects/doctrine-common/en/latest/reference/annotations.html</a></p>
<p>Annotations in entities are being used for mapping with database,</p>
<p>IDs must be like
@ORM\Id
@ORM\Column(type=&quot;integer&quot;)
@ORM\GeneratedValue(strategy=&quot;IDENTITY&quot;)</p>
<h4 id="timestampable-fields--entities">Timestampable fields / entities</h4>
<p>You must create &quot;set&quot; methods of timestampable fields.
This will improve testability and turn the creation of reallife like fixtures possible.</p>
<h4 id="createdat">CreatedAt</h4>
<p>&quot;createdAt&quot; property should be set in constructor through &quot;setCreatedAt&quot; method like:</p>
<pre><code>public function __construct()
{
        $this-&gt;setCreatedAt(new \DateTime());
}</code></pre>
<p>that method shall be something like:</p>
<pre><code>public function setCreatedAt(\DateTime $createdAt)
{
        $this-&gt;createdAt = $createdAt;
        return $this;
}</code></pre>
<h4 id="updatedat">UpdatedAt</h4>
<p>&quot;updatedAt&quot; property should be set in constructor through &quot;getUpdatedAt&quot; method like:</p>
<pre><code>public function getUpdatedAt()
{
        return $this-&gt;updatedAt;
}</code></pre>
<p>that method shall be something like:</p>
<pre><code>public function setUpdatedAt(\DateTime $updatedAt)
{
      $this-&gt;updatedAt = $updatedAt;
      return $this;
}</code></pre>
<p></p>
<h4 id="soft-delete">Soft Delete</h4>
<pre><code>public function isDeleted()
{
    return null !== $this-&gt;deletedAt &amp;&amp; new \DateTime() &gt;= $this-&gt;deletedAt;
}

public function getDeletedAt()
{
    return $this-&gt;deletedAt;
}

public function setDeletedAt(\DateTime $deletedAt)
{
    $this-&gt;deletedAt = $deletedAt;
    return $this;
}</code></pre>
<h4 id="making-sure-a-field-match-a-string">Making sure a field match a string</h4>
<pre><code>@Assert\Choice(callback={"Beubi\Bundle\Provider\ThingProvider","getThingTypeKeyChoices"})</code></pre>
<h4 id="strings">Strings</h4>
<p>Each string field should have the minimum necessary length.
When it is not possible to know this minimum length use:
medium size strings should be like (e.g. used in input field):</p>
<pre><code> @ORM\Column(type="string", length=200)</code></pre>
<p>the biggest size strings should be like  (e.g. used in textarea field):</p>
<pre><code> @ORM\Column(type="string", length=255)</code></pre>
<h4 id="files">Files</h4>
<p>When uploading files to register that in db we are placing this</p>
<pre><code>@Vich\Uploadable</code></pre>
<p>in the entity, and then this</p>
<pre><code>@Assert\File(maxSize="5M", mimeTypes = {"application/pdf", "application/x-pdf"})</code></pre>
<p>At <code>$file</code> property where we are asserting file max-size and mime-types</p>
<h4 id="inheritances">Inheritances</h4>
<p>We must use when the target tables are alike</p>
<pre><code>@ORM\InheritanceType("JOINED")
@ORM\DiscriminatorMap({"Thing" = "Thing", "AnotherThing" = "AnotherThing")</code></pre>
<p>And</p>
<pre><code>@ORM\InheritanceType("SINGLE_TABLE")
@ORM\DiscriminatorMap({"file" = "File", "attachment" = "Attachment", "photo" = "Photo"})</code></pre>
<p>When target tables are different from each other (e.g. from Intervener and Attachment)</p>
<h2><a name="Naming"></a>Naming</h2>
<h3 id="variables">Variables</h3>
<p><strong>Prohibited</strong> names for variables;
<code>form</code>
<code>entity</code></p>
<h3 id="controller-methods">Controller methods</h3>
<p>Every controller method must end with &quot;Action&quot;</p>
<p><strong>Standard controller actions</strong>
<code>index</code>
the main method of a controller
<code>edit</code>
returns form
<code>update</code>
returns redirect, flash msg
<code>show</code>
returns an 'object' properties
<code>list</code>
return a list of 'objects' with their properties
<code>delete</code>
returns redirect, flash msg
<code>create</code>
redirects or returns a view with create form
<code>new</code>
returns view with form</p>
<h3 id="entity-methods">Entity methods</h3>
<p>Names of method that return a boolean must start with &quot;is...&quot; or &quot;has...&quot;
Names of method that changes a property must start with &quot;set...&quot;
Names of method that returns a property must start with &quot;get...&quot;</p>
<h3 id="entity-properties">Entity properties</h3>
<p>Properties must be in English.
No abbreviations are allowed.
When properties are ManyToOne relations they should match the class name.
e.g. &quot;user&quot;
When properties are OneToMany relations they should match the class name and be in plural.
e.g. &quot;attachments&quot;
When needed, doc block should have the field name in Portuguese.
e.g. &quot;whoCheckedTheBuilding&quot; ~&gt; &quot;Quem realizou o levantamento?&quot;</p>
<p>Word list</p>
<ul>
<li>step</li>
<li>finish</li>
<li>process</li>
<li>note</li>
<li>attachment</li>
<li>stepName</li>
<li>user</li>
<li>createdAt</li>
<li>updatedAt</li>
<li>deletedAt</li>
<li>zipCode</li>
<li>email</li>
<li>address</li>
<li>plot</li>
</ul>
<p>Entity creation and behavior</p>
<p>It must not be possible to create an &quot;invalid&quot; Entity.</p>
<h2><a name="Security"></a>Security</h2>
<p>Security rules are being used like this:</p>
<pre><code>@Security("has_role('ROLE_AUTH')")</code></pre>
<p>you can also</p>
<pre><code>@Security("is_granted('edit', step)")</code></pre>
<p>It can be used for a whole class or a single controller.
And it must be present for every rout but &quot;/&quot; - homepage (login page)</p>
<h3><a name="Roles"></a>Roles</h3>
<p>Symfony documentation about security component
<a href="http://symfony.com/doc/current/book/security.html">http://symfony.com/doc/current/book/security.html</a></p>
<p>We should use names like:</p>
<ul>
<li>ROLE_THING_CANCEL                          |</li>
<li>ROLE_THING_CHANGE_ANOTHERTHING</li>
<li>ROLE_SEARCH_BY_THING</li>
<li>ROLE_THING_ACCESS</li>
<li>ROLE_THING_EDIT</li>
<li>ROLE_THING_DELETE                          </li>
</ul>
<h3 id="use-examples">Use examples</h3>
<p>Calling service</p>
<pre><code>$this-&gt;container-&gt;get('security.context')-&gt;isGranted('ROLE_AUTH')</code></pre>
<p>From annotations</p>
<pre><code>@Security("has_role('ROLE_AUTH')</code></pre>
<h3 id="voters">Voters</h3>
<p>All voters are called each time you use the isGranted() method on Symfony's security context (i.e. the security.context service). Each one decides if the current user should have access to some resource.
To create a custom Voter, you need to implement 3 methods:</p>
<ul>
<li><code>public function supportsAttribute($attribute);</code>
Check if the voter supports the given user attribute (i.e: a role like ROLE_USER, an ACL EDIT, etc.).</li>
<li><code>public function supportsClass($class);</code>
Check if the voter supports the class of the object whose access is being checked.</li>
<li><code>public function vote(TokenInterface $token, $object, array $attributes);</code>
<ul>
<li>Method must implement the business logic that verifies whether or not the user has access. This method must return one of the following values:
<ul>
<li>VoterInterface::ACCESS_GRANTED: The authorization will be granted by this voter;</li>
<li>VoterInterface::ACCESS_ABSTAIN: The voter cannot decide if authorization should be granted;</li>
<li>VoterInterface::ACCESS_DENIED: The authorization will be denied by this voter.</li>
</ul></li>
</ul></li>
</ul>
<p><a href="http://symfony.com/doc/current/cookbook/security/voters_data_permission.html#creating-the-custom-voter">http://symfony.com/doc/current/cookbook/security/voters_data_permission.html#creating-the-custom-voter</a></p>
<h2><a name="Enumerations"></a>Enumerations (choices)</h2>
<p>A provider must be created for each enumeration.
This provider must have one constant properties for each possible choice and an array calling this constants.
This provider must implement a getTypeChoices() method which will return the possible choices.
This choices should be in form of &quot;choices.&lt;<providerName>&gt;.&lt;<choiceName>&gt;.
This choice's names must be in english and then translated in the yml translation files.
This provider should be Abstract and should be injected when needed.</p>
<p>E.g. on how should a provider look like:</p>
<pre><code>class ThingProvider
{
    const A = 'choices.thing.a';
    const B = 'choices.thing.b';
    private static $thingChoices = array(
            self::A,
            self::B
            );
    public static function getTypeChoices()
    {
        return array_combine(self::$thingChoices, self::$thingChoices);
    }
}</code></pre>
<p>These providers can be used e.g. within an Entity to assert values (@Assert\Choice) or a form to add choices.
ThingProvider::getTypeChoices()</p>
<h2><a name="Dates"></a>Dates</h2>
<p>All dates should be in <code>&lt;&lt;Day&gt;&gt;</code> <code>&lt;&lt;Month&gt;&gt;</code> <code>&lt;&lt;Year&gt;&gt;</code> format.</p>
<p>Localized dates: <code>{{ entity.createdAt | localizeddate('medium', 'none') }}</code></p>
<p>reference: <a href="http://twig.sensiolabs.org/doc/extensions/intl.html">http://twig.sensiolabs.org/doc/extensions/intl.html</a></p>
<h2><a name="DataFixtures"></a>Data Fixtures</h2>
<p>One load data fixtures class should not load more than one entity.
A method &quot;create…&quot; should be implemented in order to create an entity.
e.g. createUser()
A class &quot;DataFixture&quot; should be created from which every loading fixtures responsible classes should extend.</p>
<h2><a name="Forms"></a>Forms</h2>
<h3 id="dynamic-forms">Dynamic Forms</h3>
<p><a href="http://symfony.com/doc/current/cookbook/form/dynamic_form_modification.html">http://symfony.com/doc/current/cookbook/form/dynamic_form_modification.html</a></p>
<h3 id="change-forms">Change forms</h3>
<p>Modify form based on submitted data:
Events:
<code>PRE_SET_DATA</code>
<code>POST_SUBMIT</code></p>
<p>Create a closure to modify the form:</p>
<pre><code>$formModifier = function (FormInterface $form, $thing) {
    if (null !== $thing &amp;&amp; $thing != ThingProvider::A) {
         $form-&gt;add(...);
        …
    }
 };</code></pre>
<p>Call closure inside each event subscriber:</p>
<pre><code>$builder-&gt;addEventListener(FormEvents::PRE_SET_DATA,
    function (FormEvent $event) use ($formModifier) {
        $formModifier($event-&gt;getForm(), $data-&gt;getThing());
});

$builder-&gt;get('thing')-&gt;addEventListener(
    FormEvents::POST_SUBMIT,
    function (FormEvent $event) use ($formModifier) {
        $formModifier($event-&gt;getForm()-&gt;getParent(), $thing);
 });</code></pre>
<h3 id="dependent-forms">Dependent Forms</h3>
<p>Update the form using ajax
The trick to update the form using ajax, is just ask the form if the button was really pressed during the form submission.</p>
<pre><code>if ($form-&gt;get('save')-&gt;isClicked() &amp;&amp; $form-&gt;isValid()) {</code></pre>
<h3 id="form-events">Form Events</h3>
<p><a href="http://symfony.com/doc/current/components/form/form_events.html">http://symfony.com/doc/current/components/form/form_events.html</a></p>
<h2><a name="Testing"></a>Testing</h2>
<p>We will have blackbox and whitebox tests.</p>
<p>Blackbox tests may be using crawler and database.</p>
<p>Whitebox tests will be using behat+mink+something and will &quot;always&quot; use database.</p>
<p>Behat features folder will be placed in the project root dir.
Behat config file will be placed in the project root dir.</p>
                </section>

            </div>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yandex.st/highlightjs/7.5/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
